<!DOCTYPE html>
<body>
  <style>
    body {
      font-size: 36px;
    }

    #grid {
      display: grid;
      grid-template-rows: repeat(4, 1fr);
      grid-template-columns: repeat(4, 1fr);
      grid-gap: 80px;
    }

    #pacman {
      font-size: 10px;
      margin: 0;
      color: deeppink;
      width: fit-content;
    }

    #done {
      display: none;
    }

    #banner {
      display: none;
      background-color: deeppink;
      text-align: center;
      font-size: 64px;
      color: white;
      padding: 20px;
    }
  </style>
  <div id="banner">All words eaten</div>
  <div id="grid"></div>
  <hr />
  <div id="poem"></div>
  <div id="done">
    <button
      onclick="navigator.clipboard.writeText(document.getElementById('poem').innerText)"
    >
      Save Poem
    </button>
    <button onclick="location.reload()">Restart</button>
  </div>
  <script>
    let position = [
      Math.floor(Math.random() * 3),
      Math.floor(Math.random() * 3),
    ];
    const pacman = document.createElement("div");
    let lastPacmanId = `${position[0]}${position[1]}`;
    let finished = false;
    //     pacman.innerHTML = `<pre style="margin:0; color: deeppink;">
    // 
    // </pre>`;
    pacman.innerHTML = `
<pre id="pacman">,==.
\ o ',
 \\    \\
 /    ;
/   .'
"=="</pre>`;
    //     pacman.innerHTML = `<pre style="font-size:10px; margin:0; color: deeppink;">
    //   .--.
    //  / _.-'
    //  \\  '-.
    //   '--'
    // </pre>`;
    //     pacman.innerHTML = `<pre style="font-size:8px; margin:0; color: deeppink;">
    //          ████████
    //       ██████████████
    //    ████████  ████
    //    ███████████
    //   ████████
    //   ████████
    //    ███████████
    //    ██████████████
    //       ██████████████
    //          ████████
    // </pre>`;
    //     pacman.innerHTML = `<pre style="font-size:8px; margin:0;">
    //   ▁▁▁▁▁▁▁▁
    //  /88888888┃
    // ┃8888888/▔
    // ┃8888┃▔▔
    // ┃8888┃▁▁
    // ┃8888888\\▁
    //  \\88888888┃
    //   ▔▔▔▔▔▔▔▔▔
    // </pre>`;
    const poem = [];
    const wordsGrid = [];
    const parts = ["noun", "verb", "adjective"];
    const words = {
      noun: ["word", "eight"],
      verb: ["eating", "running"],
      adjective: ["big", "small"],
    };
    const positionsToDone = {};
    const randomPart = () => parts[Math.floor(Math.random() * parts.length)];
    const randomWord = () => {
      const randPart = randomPart();
      return words[randPart][
        Math.floor(Math.random() * words[randPart].length)
      ];
    };

    const grid = document.getElementById("grid");
    for (let i = 3; i >= 0; i--) {
      for (let j = 3; j >= 0; j--) {
        const node = document.createElement("span");
        node.id = `${i}${j}`;
        positionsToDone[`${i}${j}`] = false;

        if (position[0] === i && position[1] === j) {
          node.innerHTML = pacman.innerHTML;
        } else {
          const text = document.createTextNode(randomWord());
          node.appendChild(text);
        }
        grid.appendChild(node);
      }
    }

    document.addEventListener("keydown", (event) => {
      switch (event.key) {
        case "ArrowDown":
          if (position[0] === 0) {
            return;
          }
          position[0]--;
          pacman.children[0].style.transform = "rotate(270deg)";
          break;
        case "ArrowUp":
          if (position[0] === 3) {
            return;
          }
          position[0]++;
          pacman.children[0].style.transform = "rotate(90deg)";
          break;
        case "ArrowRight":
          if (position[1] === 0) {
            return;
          }
          position[1]--;
          pacman.children[0].style.transform = "scaleX(-1)";
          break;
        case "ArrowLeft":
          if (position[1] === 3) {
            return;
          }
          position[1]++;
          pacman.children[0].style.transform = "rotate(0deg)";
          break;
      }

      if (lastPacmanId) {
        document.getElementById(lastPacmanId).innerHTML = "";
      }
      const word = document.getElementById(`${position[0]}${position[1]}`);
      positionsToDone[`${position[0]}${position[1]}`] = true;
      poem.push(word.innerText);
      word.innerHTML = pacman.innerHTML;
      lastPacmanId = `${position[0]}${position[1]}`;
      document.getElementById("poem").innerHTML = poem
        .map((word) => `<span>${word}</span>`)
        .join(" ");
      if (!finished && Object.values(positionsToDone).every((done) => done)) {
        document.getElementById("banner").style.display = "inherit";
        document.getElementById("done").style.display = "inherit";
        finished = true;
      }
    });
  </script>
</body>
